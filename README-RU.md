1. Зависимости и сборка библиотеки

Библиотека и тесты собираются с помощью CMake, в качестве package manager-а используется vcpkg.
Для установки нужно следовать инструкциям тут: https://github.com/Microsoft/vcpkg

Когда vcpkg установлен, нужно установить следующие библиотеки (через vcpkg install):

 * boost
 * spdlog
 * fmt
 * rapidjson
 * openssl
 * gtest

Далее нужно задаить переменную среды VCPKG_ROOT указывающую на директорию в которую установлен vcpkg.
Альтернативно, можно передать переменную VCPKG_ROOT при генерации проекта CMake-ом (-DVCPKG_ROOT=/path/to/vcpkg).

Дальше можно собрать библиотеку и тесты любым удобным тулчейном поддерживаемым CMake.

Тесты можно запустить через CTest или по одному.

1.1. Сборка бандла для web теста

В директории webtest/webui лежит исходный код интерфейсной части приложения для интерактичного
тестирования библиотеки. Для сборки нужен nodejs.
Что бы установить зависимости, нужно исполнить:

    npm i

в директории webtest/webui. Что бы собрать сам бандл:

    npm run build

или

    npm run build_release

К сожалению плагин UglifyJs всё еще не поддерживает ES6 синтаксис, так 
что для сборки релизной версии нужно tsconfig.json параметр target поменять на es5.
Предсобранный релизный бандл лежит в директории webtest/webui/release.

Для запуска приложения нужно скопировать содержимое папки webtest/webui/dist если
webui был собран, или webtest/webui/release если используется предсобранная версия
в поддиректорию webroot в той же директории где расположен phkvs_webtest(.exe).

Запустить можно с опцией

    phkvs_webtest -o

что бы страничка сразу открылась в браузере.

2. Организация и формат данных

Каждый volume состоит из 3-х файлов с расширениями .phkvsmain .phkvsstm и .phkvsbig 

.phkvsmain - основной файл, представляет из себя дерево из block-skip-list-ов.

.phkvsstm - хранилище для данных маленького и среднего размера, от 16 до 256 байт, используется как
для внутренних структур данных skip list-а, так и для пользовательских данных
не слишком больших для inplace хранения в основном файле.

.phkvsbig - хранилище для строк и блобов больше 256 байт.

Все целочисленные значения хранятся в little endian формате.

2.1 Формат основного файла .phkvsmain

Заголовок:

|Поле                    | Тип/Размер | Значение | Описание                                                                               |
|------------------------|------------|----------|----------------------------------------------------------------------------------------|
|Magic                   | uint8_t[4] | 'PHVS'   | Для проверки типа файла                                                                |
|Version.Major           | uint16_t   | 1        | Старшая часть версии                                                                   |
|Version.Minor           | uint16_t   | 0        | Младшая часть версии                                                                   |
|Head fist free node     | uint64_t   |          | Смещение первой свободной головной ноды skip-list-а. 0 если нет свободных головных нод.|
|List free free node     | uint64_t   |          | Смещение первой свободной ноды skip-list-а. 0 если нет свобоных нод.                   |

Сразу за заголовком идёт головная нода корневой директории.

Головная нода:

|Поле                    | Тип/Размер | Описание                                                                               |
|------------------------|------------|----------------------------------------------------------------------------------------|
|nexts level             | uint8_t    | Количество уровней в массиве указателей на следующую ноду                              |
|next offset/stm offset  | uint64_t   | Смещение следующей ноды если nexts level == 1 или смещение в phkvsstm файле если >1    |

Каждый skip-list всегда начинается с головной ноды без значений.

Нода с данными block-skip-list-а:

|Поле                    | Тип/Размер | Описание                                                                               |
|------------------------|------------|----------------------------------------------------------------------------------------|
|nexts level             | uint8_t    | Количество уровней в массиве указателей на следующую ноду                              |
|next offset/stm offset  | uint64_t   | Смещение следующей ноды если nexts level == 1 или смещение в phkvsstm файле если >1    |
|used entries count      | uint8_t    | Количество заполненных элементов с данными                                             |
|entry array             | Entry[16]  | Элементы с данными                                                                     |

Нода имеет фиксированный размер. Не занятые ячейки с данными заполненны нулями.

Элемент данных(Entry):

|Поле                    | Тип/Размер | Описание                                                                               |
|------------------------|------------|----------------------------------------------------------------------------------------|
|flags                   | uint8_t    | Поле с флагами                                                                         |
|expirtion date          | uint64_t   | Дата истечения срока жизни ключа в миллискундах с epoch. 0 если не задана.             |
|name                    | Name(16)   | имя                                                                                    |
|value                   | Value(16)  | значение                                                                               |

Поле flags:

 * 7-й бит (0x80) - Entry содержит директорию
 * 6-й бит (0x40) - Inplace name
 * 5-й бит (0x20) - Inplace value
 * с 0 по 3-й биты (0xf) - тип значения

Если взведён бит Inplace name, то поле name содержит zero terminated строку или, если нуля нет, то все 16 байт это имя.
Имя всегда дополненно до 16-ти байт.

Если взведён бит Inplace value, то 1-й байт значения это реальный размер